const translations = {
    fr: {
      dashboard: "Tableau de Bord",
      logout: "Se déconnecter",
      
      overview: "Vue d'ensemble",
      tasks: "Tâches",
      calendar: "Calendrier",
      activity: "Activité",
      settings: "Paramètres",
      
      activitySummary: "Résumé de vos activités",
      totalTasks: "Tâches totales",
      completedTasks: "Tâches terminées",
      upcomingEvents: "Événements à venir",
      completionRate: "Taux de complétion",
      totalTasksDesc: "Nombre total de tâches",
      completedTasksDesc: "Tâches complétées",
      upcomingEventsDesc: "Événements planifiés",
      
      taskProgress: "Progression des tâches",
      week: "Semaine",
      month: "Mois",
      year: "Année",
      weekDays: ["Lun", "Mar", "Mer", "Jeu", "Ven", "Sam", "Dim"],
      months: ["Jan", "Fév", "Mar", "Avr", "Mai", "Jun", "Jul", "Aoû", "Sep", "Oct", "Nov", "Déc"],
      
      recentTasks: "Tâches récentes",
      viewAll: "Voir tout",
      upcomingEventsList: "Événements à venir",
      recentActivity: "Activité récente",
      
      taskList: "Ma Liste de Tâches",
      addTask: "Ajouter",
      addTaskPlaceholder: "Ajouter une nouvelle tâche...",
      noTasks: "Aucune tâche pour le moment",
      inProgress: "En cours",
      taskCompleted: "Terminé",
      
      myCalendar: "Mon Calendrier",
      eventTitle: "Titre de l'événement",
      eventDate: "Date",
      addEvent: "Ajouter l'événement",
      deleteEvent: "Supprimer cet événement ?",
      fillTitleDate: "Veuillez remplir le titre et la date.",
      noEvents: "Aucun événement planifié",
      
      activityLog: "Journal d'activité",
      noActivity: "Aucune activité récente",
      noCompletedTasks: "Aucune tâche terminée pour le moment.",
      taskCompletedText: "Tâche terminée:",
      justNow: "à l'instant",
      timeUnits: {
        year: ["an", "ans"],
        month: ["mois", "mois"],
        day: ["jour", "jours"],
        hour: ["heure", "heures"],
        minute: ["minute", "minutes"],
        second: ["seconde", "secondes"]
      },
      timeAgo: "il y a",
      
      settingsTitle: "⚙️ Paramètres",
      settingsSaved: "Paramètres enregistrés avec succès!",
      
      userProfile: "Profil Utilisateur",
      username: "Nom d'utilisateur",
      email: "Email",
      avatar: "Avatar (initiale)",
      
      appearance: "Apparence",
      theme: "Thème",
      light: "Clair",
      dark: "Sombre",
      language: "Langue",
      
      notifications: "Notifications",
      activityNotifications: "Notifications d'activité",
      enabled: "Activées",
      disabled: "Désactivées",
      
      account: "Compte",
      deleteAccount: "Supprimer mon compte",
      deleteConfirm: "Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible.",
      accountDeleted: "Votre compte a été supprimé avec succès.",
      
      enterUsername: "Veuillez entrer un nom d'utilisateur.",
      enterValidEmail: "Veuillez entrer une adresse email valide.",
      
      save: "Enregistrer les modifications"
    },
    
    en: {
      dashboard: "Dashboard",
      logout: "Log out",
      
      overview: "Overview",
      tasks: "Tasks",
      calendar: "Calendar",
      activity: "Activity",
      settings: "Settings",
      
      activitySummary: "Activity Summary",
      totalTasks: "Total Tasks",
      completedTasks: "Completed Tasks",
      upcomingEvents: "Upcoming Events",
      completionRate: "Completion Rate",
      totalTasksDesc: "Total number of tasks",
      completedTasksDesc: "Completed tasks",
      upcomingEventsDesc: "Scheduled events",
      
      taskProgress: "Task Progress",
      week: "Week",
      month: "Month",
      year: "Year",
      weekDays: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
      months: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      
      recentTasks: "Recent Tasks",
      viewAll: "View all",
      upcomingEventsList: "Upcoming Events",
      recentActivity: "Recent Activity",
      
      taskList: "My Task List",
      addTask: "Add",
      addTaskPlaceholder: "Add a new task...",
      noTasks: "No tasks at the moment",
      inProgress: "In progress",
      taskCompleted: "Completed",
      
      myCalendar: "My Calendar",
      eventTitle: "Event Title",
      eventDate: "Date",
      addEvent: "Add Event",
      deleteEvent: "Delete this event?",
      fillTitleDate: "Please fill in the title and date.",
      noEvents: "No scheduled events",
      
      activityLog: "Activity Log",
      noActivity: "No recent activity",
      noCompletedTasks: "No completed tasks yet.",
      taskCompletedText: "Task completed:",
      justNow: "just now",
      timeUnits: {
        year: ["year", "years"],
        month: ["month", "months"],
        day: ["day", "days"],
        hour: ["hour", "hours"],
        minute: ["minute", "minutes"],
        second: ["second", "seconds"]
      },
      timeAgo: "ago",
      
      settingsTitle: "⚙️ Settings",
      settingsSaved: "Settings saved successfully!",
      
      userProfile: "User Profile",
      username: "Username",
      email: "Email",
      avatar: "Avatar (initial)",
      
      appearance: "Appearance",
      theme: "Theme",
      light: "Light",
      dark: "Dark",
      language: "Language",
      
      notifications: "Notifications",
      activityNotifications: "Activity Notifications",
      enabled: "Enabled",
      disabled: "Disabled",
      
      account: "Account",
      deleteAccount: "Delete my account",
      deleteConfirm: "Are you sure you want to delete your account? This action is irreversible.",
      accountDeleted: "Your account has been successfully deleted.",
      
      enterUsername: "Please enter a username.",
      enterValidEmail: "Please enter a valid email address.",
      
      save: "Save changes"
    },
    
    es: {
      dashboard: "Panel de Control",
      logout: "Cerrar sesión",
      
      overview: "Resumen",
      tasks: "Tareas",
      calendar: "Calendario",
      activity: "Actividad",
      settings: "Ajustes",
      
      activitySummary: "Resumen de actividades",
      totalTasks: "Tareas totales",
      completedTasks: "Tareas completadas",
      upcomingEvents: "Próximos eventos",
      completionRate: "Tasa de finalización",
      totalTasksDesc: "Número total de tareas",
      completedTasksDesc: "Tareas completadas",
      upcomingEventsDesc: "Eventos programados",
      
      taskProgress: "Progreso de tareas",
      week: "Semana",
      month: "Mes",
      year: "Año",
      weekDays: ["Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"],
      months: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
      
      recentTasks: "Tareas recientes",
      viewAll: "Ver todo",
      upcomingEventsList: "Próximos eventos",
      recentActivity: "Actividad reciente",
      
      taskList: "Mi lista de tareas",
      addTask: "Añadir",
      addTaskPlaceholder: "Añadir una nueva tarea...",
      noTasks: "No hay tareas por el momento",
      inProgress: "En progreso",
      taskCompleted: "Completada",
      
      myCalendar: "Mi Calendario",
      eventTitle: "Título del evento",
      eventDate: "Fecha",
      addEvent: "Añadir evento",
      deleteEvent: "¿Eliminar este evento?",
      fillTitleDate: "Por favor, complete el título y la fecha.",
      noEvents: "No hay eventos programados",
      
      activityLog: "Registro de actividad",
      noActivity: "No hay actividad reciente",
      noCompletedTasks: "Aún no hay tareas completadas.",
      taskCompletedText: "Tarea completada:",
      justNow: "ahora mismo",
      timeUnits: {
        year: ["año", "años"],
        month: ["mes", "meses"],
        day: ["día", "días"],
        hour: ["hora", "horas"],
        minute: ["minuto", "minutos"],
        second: ["segundo", "segundos"]
      },
      timeAgo: "hace",
      
      settingsTitle: "⚙️ Ajustes",
      settingsSaved: "¡Ajustes guardados con éxito!",
      
      userProfile: "Perfil de usuario",
      username: "Nombre de usuario",
      email: "Correo electrónico",
      avatar: "Avatar (inicial)",
      
      appearance: "Apariencia",
      theme: "Tema",
      light: "Claro",
      dark: "Oscuro",
      language: "Idioma",
      
      notifications: "Notificaciones",
      activityNotifications: "Notificaciones de actividad",
      enabled: "Activadas",
      disabled: "Desactivadas",
      
      account: "Cuenta",
      deleteAccount: "Eliminar mi cuenta",
      deleteConfirm: "¿Está seguro de que desea eliminar su cuenta? Esta acción es irreversible.",
      accountDeleted: "Su cuenta ha sido eliminada con éxito.",
      
      enterUsername: "Por favor, introduzca un nombre de usuario.",
      enterValidEmail: "Por favor, introduzca una dirección de correo electrónico válida.",
      
      save: "Guardar cambios"
    },
    
    de: {
      dashboard: "Dashboard",
      logout: "Abmelden",
      
      overview: "Übersicht",
      tasks: "Aufgaben",
      calendar: "Kalender",
      activity: "Aktivität",
      settings: "Einstellungen",
      
      activitySummary: "Aktivitätsübersicht",
      totalTasks: "Gesamtaufgaben",
      completedTasks: "Erledigte Aufgaben",
      upcomingEvents: "Kommende Ereignisse",
      completionRate: "Abschlussrate",
      totalTasksDesc: "Gesamtzahl der Aufgaben",
      completedTasksDesc: "Erledigte Aufgaben",
      upcomingEventsDesc: "Geplante Ereignisse",
      
      taskProgress: "Aufgabenfortschritt",
      week: "Woche",
      month: "Monat",
      year: "Jahr",
      weekDays: ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"],
      months: ["Jan", "Feb", "Mär", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"],
      
      recentTasks: "Neueste Aufgaben",
      viewAll: "Alle anzeigen",
      upcomingEventsList: "Kommende Ereignisse",
      recentActivity: "Neueste Aktivität",
      
      taskList: "Meine Aufgabenliste",
      addTask: "Hinzufügen",
      addTaskPlaceholder: "Neue Aufgabe hinzufügen...",
      noTasks: "Keine Aufgaben vorhanden",
      inProgress: "In Bearbeitung",
      taskCompleted: "Erledigt",
      
      myCalendar: "Mein Kalender",
      eventTitle: "Ereignistitel",
      eventDate: "Datum",
      addEvent: "Ereignis hinzufügen",
      deleteEvent: "Dieses Ereignis löschen?",
      fillTitleDate: "Bitte Titel und Datum ausfüllen.",
      noEvents: "Keine geplanten Ereignisse",
      
      activityLog: "Aktivitätsprotokoll",
      noActivity: "Keine neuere Aktivität",
      noCompletedTasks: "Noch keine erledigten Aufgaben.",
      taskCompletedText: "Aufgabe erledigt:",
      justNow: "gerade eben",
      timeUnits: {
        year: ["Jahr", "Jahre"],
        month: ["Monat", "Monate"],
        day: ["Tag", "Tage"],
        hour: ["Stunde", "Stunden"],
        minute: ["Minute", "Minuten"],
        second: ["Sekunde", "Sekunden"]
      },
      timeAgo: "vor",
      
      settingsTitle: "⚙️ Einstellungen",
      settingsSaved: "Einstellungen erfolgreich gespeichert!",
      
      userProfile: "Benutzerprofil",
      username: "Benutzername",
      email: "E-Mail",
      avatar: "Avatar (Initial)",
      
      appearance: "Erscheinungsbild",
      theme: "Thema",
      light: "Hell",
      dark: "Dunkel",
      language: "Sprache",
      
      notifications: "Benachrichtigungen",
      activityNotifications: "Aktivitätsbenachrichtigungen",
      enabled: "Aktiviert",
      disabled: "Deaktiviert",
      
      account: "Konto",
      deleteAccount: "Mein Konto löschen",
      deleteConfirm: "Sind Sie sicher, dass Sie Ihr Konto löschen möchten? Diese Aktion ist unwiderruflich.",
      accountDeleted: "Ihr Konto wurde erfolgreich gelöscht.",
      
      enterUsername: "Bitte geben Sie einen Benutzernamen ein.",
      enterValidEmail: "Bitte geben Sie eine gültige E-Mail-Adresse ein.",
      
      save: "Änderungen speichern"
    }
  };
  
  function getTranslation() {
    const currentLang = localStorage.getItem("userLanguage") || "fr";
    return translations[currentLang] || translations.fr;
  }
  
  function translateElement(element, key) {
    const t = getTranslation();
    if (element && t[key]) {
      element.textContent = t[key];
    }
  }
  
  function translatePlaceholder(element, key) {
    const t = getTranslation();
    if (element && t[key]) {
      element.placeholder = t[key];
    }
  }
  
  function translateInterface() {
    const t = getTranslation();
    
    translateElement(document.querySelector(".header h1"), "dashboard");
    translateElement(document.querySelector("#logoutBtn"), "logout");
    
    const navItems = document.querySelectorAll(".nav-item");
    if (navItems.length >= 5) {
      translateElement(navItems[0], "overview");
      translateElement(navItems[1], "tasks");
      translateElement(navItems[2], "calendar");
      translateElement(navItems[3], "activity");
      translateElement(navItems[4], "settings");
    }
    
    translateElement(document.querySelector(".summary-title"), "activitySummary");
    
    const cardTitles = document.querySelectorAll(".card-title");
    const cardDescs = document.querySelectorAll(".card-description");
    
    if (cardTitles.length >= 4 && cardDescs.length >= 4) {
      translateElement(cardTitles[0], "totalTasks");
      translateElement(cardTitles[1], "completedTasks");
      translateElement(cardTitles[2], "upcomingEvents");
      translateElement(cardTitles[3], "completionRate");
      
      translateElement(cardDescs[0], "totalTasksDesc");
      translateElement(cardDescs[1], "completedTasksDesc");
      translateElement(cardDescs[2], "upcomingEventsDesc");
    }
    
    translateElement(document.querySelector(".chart-title"), "taskProgress");
    
    const periodBtns = document.querySelectorAll(".period-btn");
    if (periodBtns.length >= 3) {
      translateElement(periodBtns[0], "week");
      translateElement(periodBtns[1], "month");
      translateElement(periodBtns[2], "year");
    }
    
    const activePeriod = document.querySelector(".period-btn.active");
    if (activePeriod) {
      updateChartLabels(activePeriod.textContent);
    }
    
    const sectionTitles = document.querySelectorAll(".section-header h3");
    const viewAllBtns = document.querySelectorAll(".view-all");
    
    if (sectionTitles.length >= 2) {
      translateElement(sectionTitles[0], "recentTasks");
      translateElement(sectionTitles[1], "upcomingEventsList");
    }
    
    viewAllBtns.forEach(btn => {
      translateElement(btn, "viewAll");
    });
    
    translateElement(document.querySelector(".activity-title"), "recentActivity");
    
    translateTodoSection();
    translateCalendarSection();
    translateActivitySection();
    translateSettingsSection();
  }
  
  function updateChartLabels(period) {
    const t = getTranslation();
    const chartLabels = document.querySelectorAll(".chart-label");
    
    if (!chartLabels.length) return;
    
    if (period === t.week) {
      for (let i = 0; i < chartLabels.length && i < t.weekDays.length; i++) {
        chartLabels[i].textContent = t.weekDays[i];
      }
    } else if (period === t.month) {
      for (let i = 0; i < chartLabels.length; i++) {
        chartLabels[i].textContent = `S${i + 1}`;
      }
    } else if (period === t.year) {
      for (let i = 0; i < chartLabels.length && i < t.months.length; i++) {
        chartLabels[i].textContent = t.months[i];
      }
    }
  }
  
  function translateTodoSection() {
    const todoContainer = document.querySelector(".todo-container");
    if (!todoContainer) return;
    
    const t = getTranslation();
    
    translateElement(todoContainer.querySelector(".todo-title"), "taskList");
    translateElement(todoContainer.querySelector("#addTodoBtn"), "addTask");
    translatePlaceholder(todoContainer.querySelector("#newTodoInput"), "addTaskPlaceholder");
    
    const todoSummary = todoContainer.querySelector("#todoSummary");
    if (todoSummary) {
      const text = todoSummary.textContent;
      const match = text.match(/(\d+).*?(\d+)/);
      if (match) {
        const completed = match[1];
        const total = match[2];
        todoSummary.textContent = `${completed} ${t.taskCompleted.toLowerCase()}(s) ${t.timeUnits.day[0]} ${total} ${t.tasks.toLowerCase()}`;
      }
    }
    
    const todoItems = todoContainer.querySelectorAll(".todo-item");
    todoItems.forEach(item => {
      const checkbox = item.querySelector('input[type="checkbox"]');
      if (checkbox && checkbox.checked) {
        const span = item.querySelector("span");
        if (span) span.classList.add("done");
      }
    });
  }
  
  function translateCalendarSection() {
    const calendarContainer = document.querySelector(".calendar-container");
    if (!calendarContainer) return;
  
    const t = getTranslation();
  
    translateElement(calendarContainer.querySelector(".calendar-title"), "myCalendar");
    translatePlaceholder(calendarContainer.querySelector("#eventTitleInput"), "eventTitle");
    translateElement(calendarContainer.querySelector("#addEventBtn"), "addEvent");
  
    let FullCalendar;
  
    if (typeof FullCalendar !== 'undefined') {
      const calendarEl = calendarContainer.querySelector("#calendar");
      if (calendarEl) {
        FullCalendar = FullCalendar || window.FullCalendar;
        const calendar = new FullCalendar.Calendar(calendarEl, {
          locale: localStorage.getItem("userLanguage") || "fr",
          initialView: 'dayGridMonth'
        });
        calendar.render();
      }
    }
  }
  
  function translateActivitySection() {
    const activityContainer = document.querySelector(".activity-container");
    if (!activityContainer) return;
    
    const t = getTranslation();
    
    translateElement(activityContainer.querySelector(".activity-title"), "activityLog");
    
    const activityEntries = activityContainer.querySelectorAll(".activity-entry");
    activityEntries.forEach(entry => {
      const activityText = entry.querySelector(".activity-text");
      if (activityText && activityText.textContent.includes(":")) {
        const taskText = activityText.textContent.split(":")[1].trim();
        activityText.textContent = `${t.taskCompletedText} ${taskText}`;
      }
    });
  }
  
  function translateSettingsSection() {
    const settingsContainer = document.querySelector(".settings-container");
    if (!settingsContainer) return;
    
    const t = getTranslation();
    
    translateElement(settingsContainer.querySelector(".settings-title"), "settingsTitle");
    
    const sectionTitles = settingsContainer.querySelectorAll(".settings-section-title");
    if (sectionTitles.length >= 4) {
      translateElement(sectionTitles[0], "userProfile");
      translateElement(sectionTitles[1], "appearance");
      translateElement(sectionTitles[2], "notifications");
      translateElement(sectionTitles[3], "account");
    }
    
    const labels = settingsContainer.querySelectorAll(".settings-form-group label");
    if (labels.length >= 5) {
      translateElement(labels[0], "username");
      translateElement(labels[1], "email");
      translateElement(labels[2], "avatar");
      translateElement(labels[3], "theme");
      translateElement(labels[4], "language");
    }
    
    translateElement(settingsContainer.querySelector("#lightThemeBtn"), "light");
    translateElement(settingsContainer.querySelector("#darkThemeBtn"), "dark");
    
    translateElement(settingsContainer.querySelector("#notificationsOnBtn"), "enabled");
    translateElement(settingsContainer.querySelector("#notificationsOffBtn"), "disabled");
    
    translateElement(settingsContainer.querySelector("#logoutSettingsBtn"), "logout");
    translateElement(settingsContainer.querySelector("#deleteAccountBtn"), "deleteAccount");
    
    translateElement(settingsContainer.querySelector("#saveSettingsBtn"), "save");
  }
  
  function formatTimeAgo(isoDate) {
    if (!isoDate) return "";
    
    const t = getTranslation();
    const seconds = Math.floor((Date.now() - new Date(isoDate).getTime()) / 1000);
    
    const intervals = [
      { label: "year", seconds: 31536000 },
      { label: "month", seconds: 2592000 },
      { label: "day", seconds: 86400 },
      { label: "hour", seconds: 3600 },
      { label: "minute", seconds: 60 },
      { label: "second", seconds: 1 }
    ];
    
    for (let i = 0; i < intervals.length; i++) {
      const { label, seconds: s } = intervals[i];
      const count = Math.floor(seconds / s);
      
      if (count > 0) {
        const unit = t.timeUnits[label][count > 1 ? 1 : 0];
        return `${t.timeAgo} ${count} ${unit}`;
      }
    }
    
    return t.justNow;
  }
  
  window.translations = {
    getTranslation,
    translateInterface,
    formatTimeAgo,
    updateChartLabels
  };
  